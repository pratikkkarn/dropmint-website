<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mint Music - Share to Snap</title>
    <!-- FontAwesome -->
    <script src="https://kit.fontawesome.com/10fb4f8bd5.js" crossorigin="anonymous"></script>
    <!-- html2canvas for generating the share image -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
        /* --- CSS STYLES --- */
        @import url('https://fonts.googleapis.com/css2?family=Ubuntu:wght@300;400;500;700&display=swap');

        body {
            background-color: #121212; /* Spotify Dark */
            color: white;
            font-family: 'Ubuntu', sans-serif;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            padding-bottom: 100px; /* Space for player */
        }

        /* Nav */
        nav {
            background-color: #000;
            position: sticky;
            top: 0;
            z-index: 50;
        }

        nav ul {
            display: flex;
            align-items: center;
            list-style-type: none;
            height: 60px;
            padding: 0 20px;
            margin: 0;
        }

        nav ul li {
            padding: 0 15px;
            cursor: pointer;
            font-weight: 500;
            transition: color 0.3s;
        }

        nav ul li:hover {
            color: #1db954; /* Mint Green */
        }

        .brand {
            display: flex;
            align-items: center;
            font-weight: 700;
            font-size: 1.3rem;
        }

        .brand img {
            width: 36px;
            margin-right: 10px;
            filter: invert(1); /* Make generic logo white if needed */
        }

        /* Container */
        .container {
            min-height: 70vh;
            background-color: #121212;
            color: white;
            display: flex;
            margin: 20px auto;
            width: 90%;
            border-radius: 12px;
            padding: 20px;
            background: linear-gradient(#202020, #121212);
        }

        .songList {
            width: 100%;
        }

        .songList h1 {
            margin-bottom: 25px;
            font-size: 1.8rem;
        }

        .songItemContainer {
            margin-top: 20px;
        }

        .songItem {
            height: 60px;
            display: flex;
            background-color: #2a2a2a;
            color: white;
            margin: 10px 0;
            justify-content: space-between;
            align-items: center;
            border-radius: 8px; /* Softer corners */
            padding: 0 20px;
            transition: background-color 0.2s;
            cursor: pointer;
        }

        .songItem:hover {
            background-color: #3a3a3a;
        }

        .songItem img {
            width: 45px;
            height: 45px;
            margin: 0 15px;
            border-radius: 4px;
            object-fit: cover;
        }

        .songName {
            flex-grow: 1;
            font-size: 1rem;
        }

        .timestamp {
            font-size: 0.9rem;
            color: #b3b3b3;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .timestamp i {
            cursor: pointer;
            transition: transform 0.2s, color 0.2s;
        }
        
        .timestamp i:hover {
            color: #1db954;
            transform: scale(1.1);
        }

        /* Bottom Player */
        .bottom {
            position: fixed;
            height: 90px;
            bottom: 0;
            width: 100%;
            background-color: #181818;
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border-top: 1px solid #282828;
            z-index: 100;
        }

        #myProgressBar {
            width: 98%;
            cursor: pointer;
            position: absolute;
            top: -6px;
            height: 6px;
            appearance: none;
            background: transparent;
        }
        
        /* Custom Range Slider */
        #myProgressBar::-webkit-slider-runnable-track {
            background: #535353;
            height: 4px;
            border-radius: 2px;
        }
        
        #myProgressBar::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 12px;
            width: 12px;
            border-radius: 50%;
            background: #1db954;
            margin-top: -4px;
            box-shadow: 0 0 5px rgba(0,0,0,0.5);
        }

        .controls-row {
            display: flex;
            width: 100%;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            box-sizing: border-box;
            height: 100%;
        }

        .songInfo {
            display: flex;
            align-items: center;
            width: 250px;
        }

        .songInfo img {
            opacity: 0;
            transition: opacity 0.4s;
            margin-right: 15px;
            border-radius: 4px;
        }
        
        .songInfo .details {
            display: flex;
            flex-direction: column;
        }

        .songInfo .song-title {
            font-weight: 600;
            font-size: 0.9rem;
        }
        .songInfo .song-artist {
            font-size: 0.75rem;
            color: #b3b3b3;
        }

        .icons {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .icons i {
            cursor: pointer;
            color: #b3b3b3;
            transition: color 0.2s;
        }

        .icons i:hover {
            color: white;
        }

        #masterPlay {
            color: white;
            font-size: 2.5rem;
        }
        
        #masterPlay:hover {
            color: #1db954;
            transform: scale(1.05);
        }

        .actions {
            display: flex;
            align-items: center;
            width: 250px;
            justify-content: flex-end;
            gap: 15px;
        }

        /* Share Button Styling */
        .share-btn {
            background: transparent;
            border: 1px solid #b3b3b3;
            color: white;
            padding: 6px 14px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
        }

        .share-btn:hover {
            border-color: white;
            transform: scale(1.05);
        }
        
        .share-btn i {
            color: #1db954;
        }

        /* SHARE CARD TEMPLATE (Hidden) 
           This is what gets screenshotted for the Story */
        #share-card-container {
            position: fixed;
            top: 0;
            left: -9999px; /* Hide off screen */
            width: 1080px;
            height: 1920px; /* 9:16 Aspect Ratio */
            background: linear-gradient(180deg, #1e1e1e 0%, #000000 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-family: 'Ubuntu', sans-serif;
            color: white;
            z-index: 9999;
        }

        /* Realistic background accent based on artwork */
        .share-bg-accent {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 50% 30%, rgba(29, 185, 84, 0.4), transparent 70%);
            z-index: 1;
        }

        .share-content {
            z-index: 2;
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
        }

        .share-art {
            width: 650px;
            height: 650px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.6);
            margin-bottom: 80px;
            object-fit: cover;
        }

        .share-title {
            font-size: 3.5rem;
            font-weight: 800;
            margin: 0;
            text-align: center;
            max-width: 80%;
        }

        .share-artist {
            font-size: 2rem;
            color: #b3b3b3;
            margin-top: 20px;
            font-weight: 500;
        }

        .share-logo {
            margin-top: 150px;
            display: flex;
            align-items: center;
            gap: 20px;
            opacity: 0.8;
        }
        .share-logo img { width: 60px; filter: invert(1); }
        .share-logo span { font-size: 1.8rem; font-weight: 700; }

        /* The "Spotify >" Style Link Chip */
        .share-pill {
            margin-top: 120px;
            background-color: white;
            color: black;
            padding: 20px 50px;
            border-radius: 100px;
            font-size: 1.8rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        /* Toast Notification */
        #toast {
            visibility: hidden;
            min-width: 250px;
            background-color: #1db954;
            color: #000;
            text-align: center;
            border-radius: 50px;
            padding: 16px;
            position: fixed;
            z-index: 1000;
            left: 50%;
            bottom: 110px; /* Above player */
            transform: translateX(-50%);
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            opacity: 0;
            transition: opacity 0.3s, bottom 0.3s;
        }

        #toast.show {
            visibility: visible;
            opacity: 1;
            bottom: 120px;
        }

        /* Loading Overlay for generation */
        #loading-overlay {
            position: fixed;
            top:0; left:0; width:100%; height:100%;
            background: rgba(0,0,0,0.8);
            z-index: 2000;
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            color: white;
        }
        .spinner {
            border: 4px solid rgba(255,255,255,0.1);
            border-left-color: #1db954;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    </style>
</head>
<body>

    <!-- Nav -->
    <nav>
        <ul>
            <li class="brand">
                <!-- Simple SVG Placeholder for logo -->
                <svg width="24" height="24" viewBox="0 0 24 24" fill="white" style="margin-right:8px;">
                    <circle cx="12" cy="12" r="10" fill="#1db954"/>
                    <path d="M8 12h8v2H8z" fill="black"/> 
                </svg>
                Mint
            </li>
            <li>Home</li>
            <li>About</li>
        </ul>
    </nav>

    <!-- Main Content -->
    <div class="container">
        <div class="songList">
            <h1>Best of Mint Music</h1>
            <div class="songItemContainer">
                <!-- Songs will be populated by JS for better management, but keeping structure -->
            </div>
        </div>
        <div class="songBanner"></div>
    </div>

    <!-- Bottom Player -->
    <div class="bottom">
        <input type="range" name="range" id="myProgressBar" min="0" value="0" max="100">
        
        <div class="controls-row">
            <!-- Song Info -->
            <div class="songInfo">
                <img src="https://via.placeholder.com/45" width="45px" alt="" id="currentThumb">
                <div class="details">
                    <span id="masterSongName">Select a song</span>
                    <span id="masterArtist" class="song-artist">Mint Music</span>
                </div>
            </div>

            <!-- Controls -->
            <div class="icons">
                <i class="fa-solid fa-2x fa-backward-step" id="previous"></i>
                <i class="fa-regular fa-3x fa-circle-play" id="masterPlay"></i>
                <i class="fa-solid fa-2x fa-forward-step" id="next"></i>
            </div>

            <!-- Volume & Share -->
            <div class="actions">
                <button class="share-btn" onclick="shareCurrentSong()">
                    <i class="fa-solid fa-share-nodes"></i> Share
                </button>
                <div class="volumeControl" style="display:flex; align-items:center; gap:5px;">
                    <span id="volumeIcon" style="font-size: 0.8rem;">ðŸ”Š</span>
                    <input type="range" id="volumeSlider" min="0" max="1" step="0.01" value="1" style="width: 70px;">
                </div>
            </div>
        </div>
    </div>

    <!-- Hidden Share Template (High Resolution for Snap/IG) -->
    <div id="share-card-container">
        <div class="share-bg-accent"></div>
        <div class="share-content">
            <img src="" class="share-art" id="share-art-img">
            <h1 class="share-title" id="share-title-text">Song Title</h1>
            <p class="share-artist" id="share-artist-text">Artist Name</p>
            
            <!-- The Magic "Pill" -->
            <div class="share-pill">
                <img src="https://upload.wikimedia.org/wikipedia/commons/1/19/Spotify_logo_without_text.svg" width="40" alt="Icon">
                Play on Mint Music &gt;
            </div>

            <div class="share-logo">
                <svg width="40" height="40" viewBox="0 0 24 24" fill="white">
                    <circle cx="12" cy="12" r="10" fill="#1db954"/>
                </svg>
                <span>Mint Music</span>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div id="toast">Link copied! Open Stories & use Paperclip ðŸ“Ž</div>

    <!-- Loading Overlay -->
    <div id="loading-overlay">
        <div class="spinner"></div>
        <div>Generating Snap...</div>
    </div>

    <script>
        // --- DATA ---
        // Using placeholder images and audio for demonstration
        const songs = [
            { songName: "Neon Nights", artist: "Pratik Karn", filePath: "dummy1.mp3", coverPath: "https://images.unsplash.com/photo-1493225255756-d9584f8606e9?w=500&auto=format&fit=crop&q=60" },
            { songName: "Skyline Drift", artist: "The Mint Crew", filePath: "dummy2.mp3", coverPath: "https://images.unsplash.com/photo-1470225620780-dba8ba36b745?w=500&auto=format&fit=crop&q=60" },
            { songName: "Urban Echoes", artist: "Soundscape", filePath: "dummy3.mp3", coverPath: "https://images.unsplash.com/photo-1511671782779-c97d3d27a1d4?w=500&auto=format&fit=crop&q=60" },
            { songName: "Midnight Blue", artist: "Jazz Vibes", filePath: "dummy4.mp3", coverPath: "https://images.unsplash.com/photo-1514525253440-b393452e8d26?w=500&auto=format&fit=crop&q=60" },
            { songName: "Electric Dreams", artist: "Synthwave Boy", filePath: "dummy5.mp3", coverPath: "https://images.unsplash.com/photo-1508700115892-45ecd05ae2ad?w=500&auto=format&fit=crop&q=60" }
        ];

        // --- ELEMENTS ---
        const songItemContainer = document.querySelector('.songItemContainer');
        const masterPlay = document.getElementById('masterPlay');
        const myProgressBar = document.getElementById('myProgressBar');
        const masterSongName = document.getElementById('masterSongName');
        const masterArtist = document.getElementById('masterArtist');
        const currentThumb = document.getElementById('currentThumb');
        const audioElement = new Audio(); // HTML5 Audio
        
        // Share Elements
        const shareCardContainer = document.getElementById('share-card-container');
        const shareArtImg = document.getElementById('share-art-img');
        const shareTitleText = document.getElementById('share-title-text');
        const shareArtistText = document.getElementById('share-artist-text');
        const loadingOverlay = document.getElementById('loading-overlay');

        let songIndex = 0;

        // --- INITIALIZATION ---
        // Populate DOM
        songs.forEach((element, i) => {
            const div = document.createElement('div');
            div.className = 'songItem';
            div.innerHTML = `
                <div style="display:flex; align-items:center;">
                    <span style="color:#b3b3b3; margin-right:15px; width:10px;">${i + 1}</span>
                    <img src="${element.coverPath}" alt="cover">
                    <span class="songName">${element.songName} <br><span style="font-size:0.75rem; color:#b3b3b3;">${element.artist}</span></span>
                </div>
                <span class="songlistplay"><i id="${i}" class="far fa-circle-play songItemPlay"></i></span>
            `;
            // Add click listener to the whole row
            div.addEventListener('click', () => {
                playSong(i);
            });
            songItemContainer.appendChild(div);
        });

        // --- PLAYER LOGIC ---
        
        function playSong(index) {
            songIndex = index;
            // In a real app, this would be songs[index].filePath
            // Using a sample generic mp3 for all for demo purposes if files don't exist
            audioElement.src = "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3"; 
            
            masterSongName.innerText = songs[songIndex].songName;
            masterArtist.innerText = songs[songIndex].artist;
            currentThumb.src = songs[songIndex].coverPath;
            currentThumb.style.opacity = "1";
            
            audioElement.currentTime = 0;
            audioElement.play();
            updatePlayIcon(true);
            updateListIcons();
        }

        function updatePlayIcon(isPlaying) {
            if(isPlaying) {
                masterPlay.classList.remove('fa-circle-play');
                masterPlay.classList.add('fa-circle-pause');
            } else {
                masterPlay.classList.remove('fa-circle-pause');
                masterPlay.classList.add('fa-circle-play');
            }
        }

        function updateListIcons() {
            // Reset all
            Array.from(document.getElementsByClassName('songItemPlay')).forEach((element) => {
                element.classList.remove('fa-circle-pause');
                element.classList.add('fa-circle-play');
            });
            // Set current
            const activeItem = document.getElementById(`${songIndex}`);
            if(activeItem && !audioElement.paused) {
                activeItem.classList.remove('fa-circle-play');
                activeItem.classList.add('fa-circle-pause');
            }
        }

        // Handle Play/Pause Click
        masterPlay.addEventListener('click', () => {
            if (audioElement.paused || audioElement.currentTime <= 0) {
                if(audioElement.src === "") {
                    playSong(0); // Play first if nothing loaded
                } else {
                    audioElement.play();
                    updatePlayIcon(true);
                    updateListIcons();
                }
            } else {
                audioElement.pause();
                updatePlayIcon(false);
                updateListIcons();
            }
        });

        // Progress Bar logic
        audioElement.addEventListener('timeupdate', () => {
            if(!isNaN(audioElement.duration)){
                const progress = parseInt((audioElement.currentTime / audioElement.duration) * 100);
                myProgressBar.value = progress;
            }
        });

        myProgressBar.addEventListener('change', () => {
            if(!isNaN(audioElement.duration)){
                audioElement.currentTime = myProgressBar.value * audioElement.duration / 100;
            }
        });

        // Next/Prev
        document.getElementById('next').addEventListener('click', () => {
            songIndex = (songIndex >= songs.length - 1) ? 0 : songIndex + 1;
            playSong(songIndex);
        });

        document.getElementById('previous').addEventListener('click', () => {
            songIndex = (songIndex <= 0) ? 0 : songIndex - 1;
            playSong(songIndex);
        });


        // --- SHARE LOGIC (The Core Request) ---

        async function shareCurrentSong() {
            const currentSong = songs[songIndex];
            
            // 1. Show loading state
            loadingOverlay.style.display = 'flex';

            // 2. Populate the Hidden Share Template
            shareArtImg.src = currentSong.coverPath;
            // Cross-origin image handling for canvas
            shareArtImg.crossOrigin = "Anonymous"; 
            shareTitleText.innerText = currentSong.songName;
            shareArtistText.innerText = currentSong.artist;

            // Wait a moment for image to load in DOM (crucial for html2canvas)
            await new Promise(r => setTimeout(r, 500));

            try {
                // 3. Generate Image Blob from DOM
                const canvas = await html2canvas(shareCardContainer, {
                    useCORS: true, // Allow loading external images
                    scale: 1, // Keep 1080x1920 (or screens scale)
                    backgroundColor: null // Transparent logic if needed, but we set BG
                });

                canvas.toBlob(async (blob) => {
                    // Create file from blob
                    const file = new File([blob], "mint-music-share.png", { type: "image/png" });

                    // 4. Copy Link Logic (The "Link Attachment" requirement)
                    const dummyLink = window.location.href + "?song=" + encodeURIComponent(currentSong.songName);
                    
                    // Fallback copy method
                    if (navigator.clipboard && navigator.clipboard.writeText) {
                        await navigator.clipboard.writeText(dummyLink);
                    } else {
                        // Older copy hack
                        const textArea = document.createElement("textarea");
                        textArea.value = dummyLink;
                        document.body.appendChild(textArea);
                        textArea.select();
                        document.execCommand("Copy");
                        textArea.remove();
                    }

                    // 5. Show Toast
                    showToast();

                    // 6. Native Share API
                    // We send ONLY the file to force "Photo" mode in Snapchat/IG Stories
                    if (navigator.canShare && navigator.canShare({ files: [file] })) {
                        try {
                            await navigator.share({
                                files: [file],
                                // title: 'Listen on Mint Music', // Some browsers convert this to link mode, safe to omit
                                // text: 'Check this out!', 
                            });
                        } catch (err) {
                            console.log("Share cancelled or failed", err);
                        }
                    } else {
                        alert("Your browser doesn't support direct image sharing. The image has been generated, but we can't open Snapchat automatically.");
                    }
                    
                    loadingOverlay.style.display = 'none';

                }, 'image/png');

            } catch (error) {
                console.error("Error generating share card:", error);
                loadingOverlay.style.display = 'none';
                alert("Could not generate share image.");
            }
        }

        function showToast() {
            const toast = document.getElementById("toast");
            toast.className = "show";
            setTimeout(function(){ toast.className = toast.className.replace("show", ""); }, 4000);
        }

    </script>
</body>
</html>
